<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Quick Guide to dgpsi • dgpsi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A Quick Guide to dgpsi">
<meta name="description" content="DGP emulation of a step function.
">
<meta property="og:description" content="DGP emulation of a step function.
">
<meta property="og:image" content="http://mingdeyu.github.io/dgpsi-R/logo.png">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dgpsi</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.5.0-9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/dgpsi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/large_scale_emulation.html">Large-Scale DGP Emulation
    </a></li>
    <li><a class="dropdown-item" href="../articles/linked_DGP.html">Linked (D)GP Emulation</a></li>
    <li><a class="dropdown-item" href="../articles/motorcycle.html">Non-Gaussian Emulation</a></li>
    <li><a class="dropdown-item" href="../articles/classification.html">DGP Classification
    </a></li>
    <li><a class="dropdown-item" href="../articles/seq_design.html">Sequential Design I</a></li>
    <li><a class="dropdown-item" href="../articles/seq_design_2.html">Sequential Design II</a></li>
    <li><a class="dropdown-item" href="../articles/bayes_opt.html">Bayesian Optimization</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mingdeyu/dgpsi-R/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>A Quick Guide to dgpsi</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mingdeyu/dgpsi-R/blob/master/vignettes/dgpsi.Rmd" class="external-link"><code>vignettes/dgpsi.Rmd</code></a></small>
      <div class="d-none name"><code>dgpsi.Rmd</code></div>
    </div>

    
    
<p>The <code>dgpsi</code> package offers a flexible toolbox for Gaussian
process (GP), deep Gaussian process (DGP), and linked (D)GP emulation.
In this guide, we show how to use the package to emulate a step function
using a three-layered DGP structure. Additional examples showcasing the
package’s functionality are available in the <a href="https://mingdeyu.github.io/dgpsi-R/dev/articles/index.html" class="external-link">Articles</a>
section of the package website. Topics include <a href="https://mingdeyu.github.io/dgpsi-R/dev/articles/linked_DGP.html" class="external-link">linked
DGPs</a>, <a href="https://mingdeyu.github.io/dgpsi-R/dev/articles/large_scale_emulation.html" class="external-link">scalable
DGPs</a>, <a href="https://mingdeyu.github.io/dgpsi-R/dev/articles/classification.html" class="external-link">DGPs
for classification</a>, <a href="https://mingdeyu.github.io/dgpsi-R/dev/articles/motorcycle.html" class="external-link">non-Gaussian
problems</a>, <a href="https://mingdeyu.github.io/dgpsi-R/dev/articles/seq_design.html" class="external-link">sequential
design and active learning for (D)GPs</a>, and <a href="https://mingdeyu.github.io/dgpsi-R/dev/articles/bayes_opt.html" class="external-link">Bayesian
optimization with (D)GPs</a>. A detailed reference for all available
functions is provided in the <a href="https://mingdeyu.github.io/dgpsi-R/dev/reference/index.html" class="external-link">Reference</a>
section of the package website.</p>
<div class="section level2">
<h2 id="load-the-package">Load the package<a class="anchor" aria-label="anchor" href="#load-the-package"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mingdeyu/dgpsi-R" class="external-link">dgpsi</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="set-up-the-step-function">Set up the step function<a class="anchor" aria-label="anchor" href="#set-up-the-step-function"></a>
</h2>
<p><code>dgpsi</code> provides a function <code><a href="../reference/init_py.html">init_py()</a></code> that
helps us set up, initialize, re-install, or uninstall the underlying
Python environment. We could run <code><a href="../reference/init_py.html">init_py()</a></code> every time after
<code>dgpsi</code> is loaded to manually initiate the Python
environment. Alternatively, we could activate the Python environment by
simply executing a function from <code>dgpsi</code>. For example, the
Python environment will be automatically loaded after we run
<code><a href="../reference/set_seed.html">set_seed()</a></code> from the package to specify a seed for
reproducibility:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_seed.html">set_seed</a></span><span class="op">(</span><span class="fl">9999</span><span class="op">)</span></span></code></pre></div>
<p>Define the step function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>and generate ten training data points:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">f</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="training">Training<a class="anchor" aria-label="anchor" href="#training"></a>
</h2>
<p>We now build and train a DGP emulator with three layers:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dgp.html">dgp</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, depth <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Auto-generating a 3-layered DGP structure ... done</span></span>
<span><span class="co">## Initializing the DGP emulator ... done</span></span>
<span><span class="co">## Training the DGP emulator: </span></span>
<span><span class="co">## Iteration 500: Layer 3: 100%|██████████| 500/500 [00:03&lt;00:00, 148.10it/s]</span></span>
<span><span class="co">## Imputing ... done</span></span></code></pre>
<p>The progress bar displayed shows how long it takes to finish
training. We are able to switch off the progress bar and the trace
information by setting <code>verb = FALSE</code>. Note that if we want
to train the DGP emulator <code>m</code> for additional iterations, we
can simply do <code>m &lt;- continue(m)</code> instead of rebuilding the
DGP emulator.</p>
<p>The trained DGP emulator can be visualized using the
<code><a href="../reference/summary.html">summary()</a></code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<iframe src="dgpsi/dgpsi_summary.html" width="100%" height="410" style="border: none;">
</iframe>
<p>The visualization gives key information about the trained DGP
emulator. Note that in the auto-generated emulator we have nugget terms
fixed to <code>1e-6</code> for all GP nodes because we are emulating a
deterministic step function (i.e., we would like our emulator to
interpolate training data points). The prior scales (i.e., variances)
for GP nodes in the first and second layers are fixed to
<code>1.0</code> while that for the GP node in the final layer is
estimated due to its attachment to the output. For further information
on how to change the default settings to construct and train a DGP
emulator, see <code><a href="../reference/dgp.html">?dgp</a></code>.</p>
<p>At this point, you could use <code><a href="../reference/write.html">write()</a></code> to save the
emulator <code>m</code> to a local file and then load it using
<code><a href="../reference/read.html">read()</a></code> when you would like to make predictions from the
emulator, e.g., on another computer that also has the package
installed.</p>
</div>
<div class="section level2">
<h2 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h2>
<p>After we have the emulator, we can validate it by drawing the
validation plots. There are two types of validation plots provided by
the package. The first one is the Leave-One-Out (LOO) cross validation
plot:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Validating and computing ... done</span></span>
<span><span class="co">## Post-processing LOO results ... done</span></span>
<span><span class="co">## Plotting ... done</span></span></code></pre>
<p><img src="https://raw.githubusercontent.com/mingdeyu/dgpsi-R/master/vignettes/images/step_fct_loo.png" style="width:100.0%"></p>
<p>The second validation plot is the Out-Of-Sample (OOS) validation plot
that requires an out-of-sample testing data set. Here we generate an OOS
data set that contains 10 testing data points:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oos_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">oos_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">oos_x</span>, <span class="va">f</span><span class="op">)</span></span></code></pre></div>
<p>We can now perform OOS validation:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m</span>,<span class="va">oos_x</span>,<span class="va">oos_y</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Validating and computing ... done</span></span>
<span><span class="co">## Post-processing OOS results ... done</span></span>
<span><span class="co">## Plotting ... done</span></span></code></pre>
<p><img src="https://raw.githubusercontent.com/mingdeyu/dgpsi-R/master/vignettes/images/step_fct_oos.png" style="width:100.0%"></p>
<p>Note that the <code>style</code> argument to the <code><a href="../reference/plot.html">plot()</a></code>
function can be used to draw different types of plot (see
<code><a href="../reference/plot.html">?plot</a></code>).</p>
</div>
<div class="section level2">
<h2 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h2>
<p>Once the validation is done, we can make predictions from the DGP
emulator. We generate 200 data points from the step function over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[0,1]</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">test_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">test_x</span>, <span class="va">f</span><span class="op">)</span></span></code></pre></div>
<p>and predict at these locations:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict.html">predict</a></span><span class="op">(</span><span class="va">m</span>, x <span class="op">=</span> <span class="va">test_x</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/predict.html">predict()</a></code> function returns an updated DGP emulator
<code>m</code> that contains a slot named <code>results</code> that
gives the posterior predictive means and variances at testing positions.
We can extract this information and plot the emulation results to check
the predictive performance of our constructed DGP emulator:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">mean</span> <span class="co"># extract the predictive means </span></span>
<span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">var</span><span class="op">)</span> <span class="co"># extract the predictive variance and compute the predictive standard deviations</span></span>
<span><span class="co"># compute predictive bounds which are two predictive standard deviations above and below the predictive means</span></span>
<span><span class="va">up</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">sd</span> </span>
<span><span class="va">lo</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">sd</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">test_x</span>, <span class="va">mu</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">'black'</span>, xlab <span class="op">=</span> <span class="st">'x'</span>, cex.axis <span class="op">=</span> <span class="fl">1.3</span>, cex.lab <span class="op">=</span> <span class="fl">1.3</span>, ylab <span class="op">=</span> <span class="st">'y'</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>  <span class="co"># predictive means </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">test_x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">test_x</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">up</span>,<span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">lo</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'grey80'</span>, border <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co"># credible interval</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">test_x</span>, <span class="va">test_y</span>, type <span class="op">=</span> <span class="st">'l'</span>, col <span class="op">=</span> <span class="st">"#D55E00"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Underlying truth</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">test_x</span>, <span class="va">mu</span>, type <span class="op">=</span> <span class="st">'l'</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, type <span class="op">=</span> <span class="st">'p'</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"#0072B2"</span><span class="op">)</span> <span class="co"># Training data points</span></span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/mingdeyu/dgpsi-R/master/vignettes/images/step_fct_result.png" style="width:100.0%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://mingdeyu.github.io" class="external-link">Deyu Ming</a>, <a href="https://experts.exeter.ac.uk/23142-daniel-williamson" class="external-link">Daniel Williamson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
