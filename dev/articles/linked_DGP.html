<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Linked (D)GP emulation of a synthetic system of three linked computer models.
">
<title>Linked (D)GP Emulation â€¢ dgpsi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Linked (D)GP Emulation">
<meta property="og:description" content="Linked (D)GP emulation of a synthetic system of three linked computer models.
">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dgpsi</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.4.0-9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/dgpsi.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/motorcycle.html">DGP Emulation with the Heteroskedastic Gaussian Likelihood
</a>
    <a class="dropdown-item" href="../articles/linked_DGP.html">Linked (D)GP Emulation</a>
    <a class="dropdown-item" href="../articles/seq_design.html">Sequential Design I</a>
    <a class="dropdown-item" href="../articles/seq_design_2.html">Sequential Design II</a>
    <a class="dropdown-item" href="../articles/large_scale_emulation.html">Large-scale DGP Emulation
</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mingdeyu/dgpsi-R/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Linked (D)GP Emulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mingdeyu/dgpsi-R/blob/HEAD/vignettes/linked_DGP.Rmd" class="external-link"><code>vignettes/linked_DGP.Rmd</code></a></small>
      <div class="d-none name"><code>linked_DGP.Rmd</code></div>
    </div>

    
    
<p>This vignette shows how to use the package to emulate a feed-forward
system of three synthetic computer models.</p>
<div class="section level2">
<h2 id="load-the-package">Load the package<a class="anchor" aria-label="anchor" href="#load-the-package"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mingdeyu/dgpsi-R" class="external-link">dgpsi</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="construct-a-synthetic-system">Construct a synthetic system<a class="anchor" aria-label="anchor" href="#construct-a-synthetic-system"></a>
</h2>
<p>We consider the following synthetic system</p>
<p><img src="images/linked_model.png" style="width:60.0%"></p>
<p>that involves three models defined by:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model 1</span></span>
<span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">7.5</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Model 2</span></span>
<span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">4</span><span class="op">/</span><span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>  </span>
<span><span class="op">}</span></span>
<span><span class="co"># Model 3</span></span>
<span><span class="va">f3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Linked Model </span></span>
<span><span class="va">f123</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">f3</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">f1</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,<span class="fu">f2</span><span class="op">(</span><span class="fu">f1</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We then specify a seed with <code><a href="../reference/set_seed.html">set_seed()</a></code> from the package
for reproducibility</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_seed.html">set_seed</a></span><span class="op">(</span><span class="fl">999</span><span class="op">)</span></span></code></pre></div>
<p>and generate 10 training data points for Model 1 and 15 training data
points for Model 2 and 3:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Training data for Model 1</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">Y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">f1</span><span class="op">)</span></span>
<span><span class="co"># Training data for Model 2</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">Y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">X2</span>, <span class="va">f2</span><span class="op">)</span></span>
<span><span class="co"># Training data for Model 3</span></span>
<span><span class="va">X3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">X2</span>, <span class="va">Y2</span><span class="op">)</span></span>
<span><span class="va">Y3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X3</span>, <span class="va">f3</span>, MARGIN <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="emulation-of-model-1">Emulation of Model 1<a class="anchor" aria-label="anchor" href="#emulation-of-model-1"></a>
</h2>
<p>We construct and train a GP emulator with MatÃ©rn-2.5 kernel:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gp.html">gp</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">Y1</span>, name <span class="op">=</span> <span class="st">"matern2.5"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Auto-generating a GP structure ... done</span></span>
<span><span class="co">## Initializing the GP emulator ... done</span></span>
<span><span class="co">## Training the GP emulator ... done</span></span></code></pre>
<p>We now validate the trained GP emulator by <code><a href="../reference/plot.html">plot()</a></code> by LOO
(alternatively, one can first use <code><a href="../reference/validate.html">validate()</a></code> to store the
LOO results before plotting with <code><a href="../reference/plot.html">plot()</a></code>):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Initializing ... done</span></span>
<span><span class="co">## Post-processing LOO results ... done</span></span>
<span><span class="co">## Plotting ... done</span></span></code></pre>
<p><img src="images/model_1_loo.png"></p>
<p>Since we will use <code>m1</code> later for linked emulation, we must
specify how it links to the emulators in the feeding layer through
<code>linked_idx</code> in <code><a href="../reference/dgp.html">dgp()</a></code>. Since <code>m1</code> is
in the first layer of the system, <code>linked_idx</code> refers to the
column indices of the global input <code>X</code> that will feed into
<code>m1</code>, and therefore we should have set
<code>linked_idx = c(1)</code> in <code><a href="../reference/dgp.html">dgp()</a></code> when we first
constructed the emulator. Instead of re-training the emulator to provide
this information, we can simply use <code><a href="../reference/set_linked_idx.html">set_linked_idx()</a></code> to add
this information to <code>m1</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_linked_idx.html">set_linked_idx</a></span><span class="op">(</span><span class="va">m1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="emulation-of-model-2">Emulation of Model 2<a class="anchor" aria-label="anchor" href="#emulation-of-model-2"></a>
</h2>
<p>We construct a two-layered DGP emulator with MatÃ©rn-2.5 kernels to
emulate the Model 2:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dgp.html">dgp</a></span><span class="op">(</span><span class="va">X2</span>, <span class="va">Y2</span>, depth <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"matern2.5"</span>, linked_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Auto-generating a 2-layered DGP structure ... done</span></span>
<span><span class="co">## Initializing the DGP emulator ... done</span></span>
<span><span class="co">## Training the DGP emulator:</span></span>
<span><span class="co">## Iteration 500: Layer 2: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 500/500 [00:01&lt;00:00, 264.72it/s]</span></span>
<span><span class="co">## Imputing ... done</span></span></code></pre>
<p>Since all outputs of emulators in the first layer is from
<code>m1</code> and <code>m2</code> uses the output from <code>m1</code>
as its input, we set <code>linked_idx = c(1)</code> in
<code><a href="../reference/dgp.html">dgp()</a></code> above.</p>
<p>The following plot visualizes the LOO of the trained DGP emulator
<code>m2</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span></code></pre></div>
<pre><code>Initializing ... done
Post-processing LOO results ... done
Plotting ... done</code></pre>
<p><img src="images/model_2_loo.png"></p>
</div>
<div class="section level2">
<h2 id="emulation-of-model-3">Emulation of Model 3<a class="anchor" aria-label="anchor" href="#emulation-of-model-3"></a>
</h2>
<p>We now construct a three-layered DGP emulator with MatÃ©rn-2.5 kernels
to emulate the Model 3:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dgp.html">dgp</a></span><span class="op">(</span> <span class="va">X3</span>, <span class="va">Y3</span>, depth <span class="op">=</span> <span class="fl">3</span>, name <span class="op">=</span> <span class="st">"matern2.5"</span>, linked_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Auto-generating a 3-layered DGP structure ... done</span></span>
<span><span class="co">## Initializing the DGP emulator ... done</span></span>
<span><span class="co">## Training the DGP emulator:</span></span>
<span><span class="co">## Iteration 500: Layer 3: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 500/500 [00:04&lt;00:00, 104.80it/s]</span></span>
<span><span class="co">## Imputing ... done</span></span></code></pre>
<p>Since <code>m3</code> takes both outputs from <code>m1</code> in
layer 1 and <code>m2</code> in layer 2, we set
<code>linked_idx = list( c(1), c(1) )</code>. The first vector in the
list says that the output dimension 1 from all emulators (i.e.,
<code>m1</code>) in the first layer feeds into <code>m3</code> and the
second vector in the list says that the output dimension 1 from all
emulators (i.e., <code>m2</code>) in the second layer feeds into
<code>m3</code>. Note that the dimensions in <code>X3</code> is ordered
in consistent with <code>linked_idx</code>, i.e., the first and second
columns of <code>X3</code> correspond to the output of <code>m1</code>
and <code>m2</code> respectively.</p>
<p>The following plot visualizes the LOO of the trained DGP emulator
<code>m3</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></span></code></pre></div>
<pre><code>Initializing ... done
Post-processing LOO results ... done
Plotting ... done</code></pre>
<p><img src="images/model_3_loo.png"></p>
</div>
<div class="section level2">
<h2 id="emulation-of-linked-model">Emulation of Linked Model<a class="anchor" aria-label="anchor" href="#emulation-of-linked-model"></a>
</h2>
<p>With the GP emulator <code>m1</code> (for Model 1), the DGP emulator
<code>m2</code> (for Model 2), and the DGP emulator <code>m3</code> (for
Model 3) at hand, we are now ready to build the linked emulator by first
using <code><a href="../reference/combine.html">combine()</a></code> to construct the system hierarchy
<code>struc</code> and then applying <code><a href="../reference/lgp.html">lgp()</a></code> for the linked
emulator.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">struc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine.html">combine</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m_link</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lgp.html">lgp</a></span><span class="op">(</span><span class="va">struc</span><span class="op">)</span></span></code></pre></div>
<p>Note that each layer of an emulator system is represented by a list.
In our case, each layer contains a single emulator. Therefore, we need
to put the corresponding emulator in a list using
<code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>.</p>
<p>We can check the relations between emulators in different layers by
applying <code><a href="../reference/summary.html">summary()</a></code> to <code>m_link</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">m_link</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## +-----------+--------------+------+----------------------------+-----------------+</span></span>
<span><span class="co">## | Layer No. | Emulator No. | Type |         Connection         | External Inputs |</span></span>
<span><span class="co">## +-----------+--------------+------+----------------------------+-----------------+</span></span>
<span><span class="co">## |  Layer 1  |    Emu 1     |  GP  |     Global input: [1]      |       No        |</span></span>
<span><span class="co">## |  Layer 2  |    Emu 1     | DGP  | Emu 1 in Layer 1: output 1 |       No        |</span></span>
<span><span class="co">## |  Layer 3  |    Emu 1     | DGP  | Emu 1 in Layer 1: output 1 |       No        |</span></span>
<span><span class="co">## |           |              |      | Emu 1 in Layer 2: output 1 |                 |</span></span>
<span><span class="co">## +-----------+--------------+------+----------------------------+-----------------+</span></span>
<span><span class="co">## 1. 'Connection' gives the indices of emulators and the associated output dimensions that are linked to the emulator referred by 'Layer No.' and 'Emulator No.'.</span></span>
<span><span class="co">## 2. 'External Inputs' indicates if the emulator (referred by 'Layer No.' and 'Emulator No.') has external inputs that are not provided by the feeding emulators.</span></span></code></pre>
<p>For comparison, we construct a GP emulator for the whole system by
generating 15 training data points from Model 1 and Model 2:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">Y_gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">X_gp</span>, <span class="va">f123</span><span class="op">)</span></span>
<span><span class="va">m_gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gp.html">gp</a></span><span class="op">(</span><span class="va">X_gp</span>, <span class="va">Y_gp</span>, name <span class="op">=</span> <span class="st">'matern2.5'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Auto-generating a GP structure ... done</span></span>
<span><span class="co">## Initializing the GP emulator ... done</span></span>
<span><span class="co">## Training the GP emulator ... done</span></span></code></pre>
<p>Finally, we validate both the GP emulator and the linked emulator at
300 testing data points over <span class="math inline">\([0,1]\)</span>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Testing input</span></span>
<span><span class="va">test_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="co"># Testing output</span></span>
<span><span class="va">test_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">test_x</span>, <span class="va">f123</span><span class="op">)</span></span>
<span><span class="co"># Validate GP emulator</span></span>
<span><span class="va">m_gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">m_gp</span>, x_test <span class="op">=</span> <span class="va">test_x</span>, y_test <span class="op">=</span> <span class="va">test_y</span>, verb <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co"># Validate linked emulator</span></span>
<span><span class="va">m_link</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">m_link</span>, x_test <span class="op">=</span> <span class="va">test_x</span>, y_test <span class="op">=</span> <span class="va">test_y</span>, verb <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>and plot them to compare their emulation performances:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GP emulator</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m_gp</span>, x_test <span class="op">=</span> <span class="va">test_x</span>, y_test <span class="op">=</span> <span class="va">test_y</span>, type <span class="op">=</span> <span class="st">'line'</span>, verb <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'GP Emulator'</span>, theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/linked_result.png"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Linked emulator</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m_link</span>, x_test <span class="op">=</span> <span class="va">test_x</span>, y_test <span class="op">=</span> <span class="va">test_y</span>, type <span class="op">=</span> <span class="st">'line'</span>, verb <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Linked Emulator'</span>, theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/linked_result_new.png"> It can be seen from the
above plots that the linked emulator outperforms the GP emulator with
significantly better mean predictions and predictive uncertainties.</p>
<p>In real-life applications, we are rarely able to generate this many
testing data points from the underlying computer simulators to evaluate
the emulators over the whole input space. However, we are still able to
retain some available realizations from the computer simulators for the
linked emulator validation. Say we were able to afford 20 runs of the
above linked computer system:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># OOS testing input</span></span>
<span><span class="va">test_x_oos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co"># OOS testing output</span></span>
<span><span class="va">test_y_oos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">test_x_oos</span>, <span class="va">f123</span><span class="op">)</span></span></code></pre></div>
<p>Then, we can conduct OOS validations for the GP emulator:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m_gp</span>, <span class="va">test_x_oos</span>, <span class="va">test_y_oos</span>, style <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Initializing ... done</span></span>
<span><span class="co">## Post-processing OOS results ... done</span></span>
<span><span class="co">## Plotting ... done</span></span></code></pre>
<p><img src="images/gp_oos.png"></p>
<p>and the linked emulator:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m_link</span>, <span class="va">test_x_oos</span>, <span class="va">test_y_oos</span>, style <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Initializing ... done</span></span>
<span><span class="co">## Post-processing OOS results ... done</span></span>
<span><span class="co">## Plotting ... done</span></span></code></pre>
<p><img src="images/linked_oos.png"> which show that the linked
emulator outperforms the GP emulator with significantly better
predictive accuracy and lower NRMSE.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Deyu Ming, Daniel Williamson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
